Turbo Assembler	 Version 4.1	    02/26/26 11:37:15	    Page 1
regist~1.asm



      1				     .286
      2	0000			     .model tiny
      3	0000			     .code
      4				     org 100h
      5				     locals @@
      6
      7	0100			     Start:
      8	0100  E8 003D				     call replace09Int
      9	0103  E8 005D				     call replace08Int
     10
     11	0106  9C				     pushf
     12	0107  0E				     push cs
     13	0108  E8 000F				     call registersDebugger09Int
     14
     15	010B  E8 0000				     call endResidentProgram
     16
     17
     18	010E			     endResidentProgram		 proc
     19
     20	010E  B8 3100						 mov ax, 3100h
     21	0111  BA 05ACr						 mov dx, offset	endOfProgram
     22	0114  C1 EA 04						 shr dx, 4
     23	0117  42						 inc dx
     24	0118  CD 21						 int 21h
     25
     26	011A			     endResidentProgram		 endp
     27				     ;-----------------------------------------------------------------------------------------------
     28				     -
     29				     ;Ends resident program.
     30				     ;Entry:
     31				     ;Exit:
     32				     ;Expected:	The label "endOfProgram" is located at the end of the code.
     33				     ;Destroyed: ax, dx
     34				     ;-----------------------------------------------------------------------------------------------
     35				     -
     36
     37	011A			     registersDebugger09Int	 proc
     38	011A  50 53 06						 push ax bx es
     39
     40	011D  E4 60						 in al,	60h
     41	011F  3C 57						 cmp al, 'W'
     42	0121  75 07						 jne @@normalMode
     43	0123  2E: C6 06	05ABr 01  +				 mov cs:printfRegsFlag,	1h
     44	      90
     45
     46	012A  E4 61		     @@normalMode:		 in al,	61h
     47	012C  0C 80						 or al,	80h
     48	012E  E6 61						 out 61h, al
     49	0130  24 7F						 and al, not 80h
     50	0132  E6 61						 out 61h, al
     51
     52	0134  B0 20						 mov al, 20h
     53	0136  E6 20						 out 20h, al
     54
     55	0138  07 5B 58						 pop es	bx ax
     56
     57	013B  EA						 db 0eah
Turbo Assembler	 Version 4.1	    02/26/26 11:37:15	    Page 2
regist~1.asm



     58	013C  0000		     old09ofs			 dw 0
     59	013E  0000		     old09seg			 dw 0
     60
     61	0140			     registersDebugger09Int	 endp
     62				     ;-----------------------------------------------------------------------------------------------
     63				     -
     64				     ;New 09 interrupt,	which raises the printfRegsFlag	to 1, when a key F11 is	pressed.
     65				     ;Entry:
     66				     ;Exit:
     67				     ;Expected:Old 09 interrupt	was replaced to	this function,
     68				     ;old09ofs contains	it's old segment and old09ofs contains it's old	offset.
     69				     ;Destroyed:
     70				     ;-----------------------------------------------------------------------------------------------
     71				     -
     72
     73
     74	0140			     replace09Int		 proc
     75	0140  B8 3509						 mov ax, 3509h
     76	0143  CD 21						 int 21h
     77
     78	0145  89 1E 013Cr					 mov old09ofs, bx
     79	0149  8C C3						 mov bx, es
     80	014B  89 1E 013Er					 mov old09seg, bx
     81
     82	014F  6A 00						 push 0
     83	0151  07						 pop es
     84
     85	0152  BB 0024						 mov bx, 4*09h
     86	0155  FA						 cli
     87	0156  26: C7 07	011Ar					 mov es:[bx], offset registersDebugger09Int
     88	015B  8C C8						 mov ax, cs
     89	015D  26: 89 47	02					 mov es:[bx+2],	ax
     90	0161  FB						 sti
     91
     92	0162  C3						 ret
     93	0163			     replace09Int		 endp
     94				     ;-----------------------------------------------------------------------------------------------
     95				     -
     96				     ;Replaces interrupt 9 with	a function registersDebugger09Int.
     97				     ;Entry:
     98				     ;Exit:
     99				     ;Expected:
    100				     ;Destroyed: ax, bx, es
    101				     ;-----------------------------------------------------------------------------------------------
    102				     -
    103
    104	0163			     replace08Int		 proc
    105
    106	0163  B8 3508						 mov ax, 3508h
    107	0166  CD 21						 int 21h
    108
    109	0168  89 1E 02BBr					 mov old08ofs, bx
    110	016C  8C C3						 mov bx, es
    111	016E  89 1E 02BDr					 mov old08seg, bx
    112
    113	0172  6A 00						 push 0
    114	0174  07						 pop es
Turbo Assembler	 Version 4.1	    02/26/26 11:37:15	    Page 3
regist~1.asm



    115
    116	0175  BB 0020						 mov bx, 4*08h
    117	0178  FA						 cli
    118	0179  26: C7 07	0186r					 mov es:[bx], offset printfRegs08Int
    119	017E  8C C8						 mov ax, cs
    120	0180  26: 89 47	02					 mov es:[bx+2],	ax
    121	0184  FB						 sti
    122
    123	0185  C3						 ret
    124	0186			     replace08Int		 endp
    125				     ;-----------------------------------------------------------------------------------------------
    126				     -
    127				     ;Replaces interrupt 8 with	a function printfRegs08Int.
    128				     ;Entry:
    129				     ;Exit:
    130				     ;Expected:
    131				     ;Destroyed: ax, bx, es
    132				     ;-----------------------------------------------------------------------------------------------
    133				     -
    134
    135
    136	0186			     printfRegs08Int		 proc
    137	0186  2E: 80 3E	05ABr 00				 cmp cs:printfRegsFlag,	0h
    138	018C  75 03						 jne @@continue
    139	018E  E9 0129						 jmp @@end
    140
    141	0191  50 53 51 52 56 57	55+  @@continue:		 push ax bx cx dx si di	bp ds es ss
    142	      1E 06 16
    143	019B  8B EC						 mov bp, sp
    144
    145	019D  68 B800						 push 0b800h
    146	01A0  07						 pop es
    147	01A1  BB 0402						 mov bx, (80d*6+33d)*2
    148
    149	01A4  26: C6 07	61					 mov byte ptr es:[bx], 'a'
    150	01A8  26: C6 47	02 78					 mov byte ptr es:[bx+2], 'x'
    151	01AD  E8 010F						 call printfHexRegValue
    152
    153	01B0  81 C3 00A0					 add bx, 80d*2
    154	01B4  26: C6 07	62					 mov byte ptr es:[bx], 'b'
    155	01B8  26: C6 47	02 78					 mov byte ptr es:[bx+2], 'x'
    156	01BD  8B 46 10						 mov ax, [bp+16]
    157	01C0  E8 00FC						 call printfHexRegValue
    158
    159	01C3  81 C3 00A0					 add bx, 80d*2
    160	01C7  26: C6 07	63					 mov byte ptr es:[bx], 'c'
    161	01CB  26: C6 47	02 78					 mov byte ptr es:[bx+2], 'x'
    162	01D0  8B 46 0E						 mov ax, [bp+14]
    163	01D3  E8 00E9						 call printfHexRegValue
    164
    165	01D6  81 C3 00A0					 add bx, 80d*2
    166	01DA  26: C6 07	64					 mov byte ptr es:[bx], 'd'
    167	01DE  26: C6 47	02 78					 mov byte ptr es:[bx+2], 'x'
    168	01E3  8B 46 0C						 mov ax, [bp+12]
    169	01E6  E8 00D6						 call printfHexRegValue
    170
    171	01E9  81 C3 00A0					 add bx, 80d*2
Turbo Assembler	 Version 4.1	    02/26/26 11:37:15	    Page 4
regist~1.asm



    172	01ED  26: C6 07	73					 mov byte ptr es:[bx], 's'
    173	01F1  26: C6 47	02 69					 mov byte ptr es:[bx+2], 'i'
    174	01F6  8B 46 0A						 mov ax, [bp+10]
    175	01F9  E8 00C3						 call printfHexRegValue
    176
    177	01FC  81 C3 00A0					 add bx, 80d*2
    178	0200  26: C6 07	64					 mov byte ptr es:[bx], 'd'
    179	0204  26: C6 47	02 69					 mov byte ptr es:[bx+2], 'i'
    180	0209  8B 46 08						 mov ax, [bp+8]
    181	020C  E8 00B0						 call printfHexRegValue
    182
    183	020F  81 C3 00A0					 add bx, 80d*2
    184	0213  26: C6 07	62					 mov byte ptr es:[bx], 'b'
    185	0217  26: C6 47	02 70					 mov byte ptr es:[bx+2], 'p'
    186	021C  8B 46 06						 mov ax, [bp+6]
    187	021F  E8 009D						 call printfHexRegValue
    188
    189	0222  81 C3 00A0					 add bx, 80d*2
    190	0226  26: C6 07	73					 mov byte ptr es:[bx], 's'
    191	022A  26: C6 47	02 70					 mov byte ptr es:[bx+2], 'p'
    192	022F  8B C4						 mov ax, sp
    193	0231  2D 001A						 sub ax, 13d*2
    194	0234  E8 0088						 call printfHexRegValue
    195
    196	0237  81 C3 00A0					 add bx, 80d*2
    197	023B  26: C6 07	64					 mov byte ptr es:[bx], 'd'
    198	023F  26: C6 47	02 73					 mov byte ptr es:[bx+2], 's'
    199	0244  8B 46 04						 mov ax, [bp+4]
    200	0247  E8 0075						 call printfHexRegValue
    201
    202	024A  81 C3 00A0					 add bx, 80d*2
    203	024E  26: C6 07	65					 mov byte ptr es:[bx], 'e'
    204	0252  26: C6 47	02 73					 mov byte ptr es:[bx+2], 's'
    205	0257  8B 46 02						 mov ax, [bp+2]
    206	025A  E8 0062						 call printfHexRegValue
    207
    208	025D  81 C3 00A0					 add bx, 80d*2
    209	0261  26: C6 07	73					 mov byte ptr es:[bx], 's'
    210	0265  26: C6 47	02 73					 mov byte ptr es:[bx+2], 's'
    211	026A  8B 46 00						 mov ax, [bp]
    212	026D  E8 004F						 call printfHexRegValue
    213
    214	0270  81 C3 00A0					 add bx, 80d*2
    215	0274  26: C6 07	63					 mov byte ptr es:[bx], 'c'
    216	0278  26: C6 47	02 73					 mov byte ptr es:[bx+2], 's'
    217	027D  8B 46 16						 mov ax, [bp+22]
    218	0280  E8 003C						 call printfHexRegValue
    219
    220	0283  81 C3 00A0					 add bx, 80d*2
    221	0287  26: C6 07	69					 mov byte ptr es:[bx], 'i'
    222	028B  26: C6 47	02 70					 mov byte ptr es:[bx+2], 'p'
    223	0290  8B 46 14						 mov ax, [bp+20]
    224	0293  E8 0029						 call printfHexRegValue
    225
    226	0296  8B 46 18						 mov ax, [bp+24]
    227	0299  81 EB 0780					 sub bx, 80d*2*12d
    228	029D  83 C3 16						 add bx, 11d*2
Turbo Assembler	 Version 4.1	    02/26/26 11:37:15	    Page 5
regist~1.asm



    229	02A0  E8 006F						 call printfFlags
    230
    231	02A3  B6 0D						 mov dh, 13d
    232	02A5  B2 0E						 mov dl, 14d
    233	02A7  B0 30						 mov al, 30h
    234
    235	02A9  E8 02B3						 call printfRegistersFrame
    236
    237	02AC  B0 20						 mov al, 20h
    238	02AE  E6 20						 out 20h, al
    239
    240	02B0  17 07 1F 5D 5F 5E	5A+				 pop ss	es ds bp di si dx cx bx	ax
    241	      59 5B 58
    242
    243	02BA  EA		     @@end:			 db 0eah
    244	02BB  0000		     old08ofs			 dw 0
    245	02BD  0000		     old08seg			 dw 0
    246
    247	02BF			     printfRegs08Int		 endp
    248				     ;-----------------------------------------------------------------------------------------------
    249				     -
    250				     ;New 08 interrupt,	which prints the updated values	​​of the processor registers
    251				     ;and flags	in a frame at each tick	of the system timer.
    252				     ;Entry:
    253				     ;Exit:
    254				     ;Expected:Old 08 interrupt	was replaced to	this function,
    255				     ;old08ofs contains	it's old segment and old08ofs contains it's old	offset.
    256				     ;Destroyed:
    257				     ;-----------------------------------------------------------------------------------------------
    258				     -
    259
    260
    261	02BF			     printfHexRegValue		 proc
    262
    263	02BF  33 D2						 xor dx, dx
    264	02C1  8A D4						 mov dl, ah
    265	02C3  C0 EA 04						 shr dl, 4h
    266
    267	02C6  80 C2 30						 add dl, 30h
    268	02C9  80 FA 39						 cmp dl, 39h
    269	02CC  76 03						 jbe @@notLetter1
    270	02CE  80 C2 07						 add dl, 7h
    271
    272	02D1  26: 88 57	06	     @@notLetter1:		 mov byte ptr es:[bx+6], dl
    273
    274	02D5  8A D4						 mov dl, ah
    275	02D7  80 E2 0F						 and dl, 00001111b
    276	02DA  80 C2 30						 add dl, 30h
    277	02DD  80 FA 39						 cmp dl, 39h
    278	02E0  76 03						 jbe @@notLetter2
    279	02E2  80 C2 07						 add dl, 7h
    280
    281	02E5  26: 88 57	08	     @@notLetter2:		 mov byte ptr es:[bx+8], dl
    282
    283	02E9  8A D0						 mov dl, al
    284	02EB  C0 EA 04						 shr dl, 4h
    285
Turbo Assembler	 Version 4.1	    02/26/26 11:37:15	    Page 6
regist~1.asm



    286	02EE  80 C2 30						 add dl, 30h
    287	02F1  80 FA 39						 cmp dl, 39h
    288	02F4  76 03						 jbe @@notLetter3
    289	02F6  80 C2 07						 add dl, 7h
    290
    291	02F9  26: 88 57	0A	     @@notLetter3:		 mov byte ptr es:[bx+10d], dl
    292
    293	02FD  8A D0						 mov dl, al
    294	02FF  80 E2 0F						 and dl, 00001111b
    295	0302  80 C2 30						 add dl, 30h
    296	0305  80 FA 39						 cmp dl, 39h
    297	0308  76 03						 jbe @@notLetter4
    298	030A  80 C2 07						 add dl, 7h
    299
    300	030D  26: 88 57	0C	     @@notLetter4:		 mov byte ptr es:[bx+12d], dl
    301
    302	0311  C3						 ret
    303	0312			     printfHexRegValue		 endp
    304				     ;-----------------------------------------------------------------------------------------------
    305				     -
    306				     ;Writes the hexadecimal value of the register to the video	memory
    307				     ;Entry: ax	= current register value
    308				     ;	     bx	= video	memory offset of the beginning of the inscription reduced by 6 bytes
    309				     ;	     (the first	6 bytes	are used to write the register name)
    310				     ;Exit:
    311				     ;Expected:	es contains video memory segment
    312				     ;Destroyed: dx
    313				     ;-----------------------------------------------------------------------------------------------
    314				     -
    315
    316	0312			     printfFlags	     proc
    317
    318	0312  8B FB					     mov di, bx
    319	0314  50 53					     push ax bx
    320	0316  E8 0088					     call printfFlagsColumn
    321	0319  5B 58					     pop bx ax
    322
    323	031B  83 C3 04					     add bx, 4h
    324
    325	031E  8B D0					     mov dx, ax
    326	0320  83 E2 01					     and dx, 0000000000000001b
    327	0323  83 FA 00					     cmp dx, 0
    328	0326  74 04					     je	@@zeroCF
    329	0328  26: C6 07	31				     mov byte ptr es:[bx], '1'
    330	032C			     @@zeroCF:
    331
    332	032C  8B D0					     mov dx, ax
    333	032E  83 E2 40					     and dx, 0000000001000000b
    334	0331  83 FA 00					     cmp dx, 0
    335	0334  74 06					     je	@@zeroZF
    336	0336  26: C6 87	00A0 31				     mov byte ptr es:[bx + 80d*2], '1'
    337	033C			     @@zeroZF:
    338	033C  8B D0					     mov dx, ax
    339	033E  81 E2 0080				     and dx, 0000000010000000b
    340	0342  83 FA 00					     cmp dx, 0
    341	0345  74 06					     je	@@zeroSF
    342	0347  26: C6 87	0140 31				     mov byte ptr es:[bx + 80d*2*2], '1'
Turbo Assembler	 Version 4.1	    02/26/26 11:37:15	    Page 7
regist~1.asm



    343	034D			     @@zeroSF:
    344	034D  8B D0					     mov dx, ax
    345	034F  81 E2 0800				     and dx, 0000100000000000b
    346	0353  83 FA 00					     cmp dx, 0
    347	0356  74 06					     je	@@zeroOF
    348	0358  26: C6 87	01E0 31				     mov byte ptr es:[bx + 80d*2*3], '1'
    349	035E			     @@zeroOF:
    350	035E  8B D0					     mov dx, ax
    351	0360  83 E2 04					     and dx, 0000000000000100b
    352	0363  83 FA 00					     cmp dx, 0
    353	0366  74 06					     je	@@zeroPF
    354	0368  26: C6 87	0280 31				     mov byte ptr es:[bx + 80d*2*4], '1'
    355	036E			     @@zeroPF:
    356	036E  8B D0					     mov dx, ax
    357	0370  83 E2 10					     and dx, 0000000000010000b
    358	0373  83 FA 00					     cmp dx, 0
    359	0376  74 06					     je	@@zeroAF
    360	0378  26: C6 87	0320 31				     mov byte ptr es:[bx + 80d*2*5], '1'
    361	037E			     @@zeroAF:
    362	037E  8B D0					     mov dx, ax
    363	0380  81 E2 0200				     and dx, 0000001000000000b
    364	0384  83 FA 00					     cmp dx, 0
    365	0387  74 06					     je	@@zeroIF
    366	0389  26: C6 87	03C0 31				     mov byte ptr es:[bx + 80d*2*6], '1'
    367	038F			     @@zeroIF:
    368	038F  8B D0					     mov dx, ax
    369	0391  81 E2 0400				     and dx, 0000010000000000b
    370	0395  83 FA 00					     cmp dx, 0
    371	0398  74 06					     je	@@zeroDF
    372	039A  26: C6 87	0460 31				     mov byte ptr es:[bx + 80d*2*7], '1'
    373
    374	03A0			     @@zeroDF:
    375	03A0  C3					     ret
    376	03A1			     printfFlags	     endp
    377				     ;-----------------------------------------------------------------------------------------------
    378				     -
    379				     ;Writes the value of the flags to the video memory
    380				     ;Entry: ax	= register of flags
    381				     ;	     bx	= video	memory offset of the CF
    382				     ;Exit:
    383				     ;Expected:	es contains video memory segment.
    384				     ;Destroyed: bx, cx, dx
    385				     ;-----------------------------------------------------------------------------------------------
    386				     -
    387
    388	03A1			     printfFlagsColumn	     proc
    389
    390	03A1  26: C6 05	63				     mov byte ptr es:[di], 'c'
    391	03A5  26: C6 85	00A0 7A				     mov byte ptr es:[di + 80d*2], 'z'
    392	03AB  26: C6 85	0140 73				     mov byte ptr es:[di + 80d*2*2], 's'
    393	03B1  26: C6 85	01E0 6F				     mov byte ptr es:[di + 80d*2*3], 'o'
    394	03B7  26: C6 85	0280 70				     mov byte ptr es:[di + 80d*2*4], 'p'
    395	03BD  26: C6 85	0320 61				     mov byte ptr es:[di + 80d*2*5], 'a'
    396	03C3  26: C6 85	03C0 69				     mov byte ptr es:[di + 80d*2*6], 'i'
    397	03C9  26: C6 85	0460 64				     mov byte ptr es:[di + 80d*2*7], 'd'
    398
    399	03CF  83 C7 02					     add di, 2
Turbo Assembler	 Version 4.1	    02/26/26 11:37:15	    Page 8
regist~1.asm



    400	03D2  B0 3D					     mov al, '='
    401	03D4  32 E4					     xor ah, ah
    402	03D6  B9 0008					     mov cx, 8h
    403	03D9  57					     push di
    404	03DA  E8 002A					     call printfVerticalString
    405	03DD  B0 00					     mov al, 0
    406	03DF  B9 0006					     mov cx, 6h
    407	03E2  E8 0022					     call printfVerticalString
    408	03E5  5F					     pop di
    409
    410
    411	03E6  83 C7 02					     add di, 2
    412	03E9  B0 30					     mov al, '0'
    413	03EB  32 E4					     xor ah, ah
    414	03ED  B9 0008					     mov cx, 8h
    415	03F0  E8 0014					     call printfVerticalString
    416
    417	03F3  57					     push di
    418	03F4  B0 00					     mov al, 0
    419	03F6  B9 0006					     mov cx, 6h
    420	03F9  E8 000B					     call printfVerticalString
    421	03FC  5F					     pop di
    422
    423	03FD  83 EF 04					     sub di, 4d
    424	0400  B9 0006					     mov cx, 6h
    425	0403  E8 0001					     call printfVerticalString
    426
    427	0406  C3					     ret
    428	0407			     printfFlagsColumn	     endp
    429				     ;----------------------------------------------------------------------------------------------
    430				     ;Prints a column with processor flags with	zeroed values.
    431				     ;Entry: di	= video	memory offset.
    432				     ;Exit:
    433				     ;Expected:	es contains the	address	of the video memory segment.
    434				     ;Destroyed: ax, bx, cx, di
    435				     ;----------------------------------------------------------------------------------------------
    436
    437	0407			     printfVerticalString     proc
    438	0407  BB 00A0					     mov bx, 80d*2
    439	040A  80 FC 00					     cmp ah, 0
    440	040D  74 02					     je	@@nextElem
    441	040F  F7 DB					     neg bx
    442
    443	0411  26: 88 05		     @@nextElem:	     mov byte ptr es:[di], al
    444	0414  03 FB					     add di, bx
    445	0416  E2 F9					     loop @@nextElem
    446
    447	0418  C3					     ret
    448
    449	0419			     printfVerticalString     endp
    450				     ;----------------------------------------------------------------------------------------------
    451				     ;Prints vertical string
    452				     ;Entry: al	= symbol binary	code
    453				     ;	     ah	= direction flag (ah = 0, di +=	80d*2; ah != 0,	di -= 80d*2)
    454				     ;	     di	= video	memory offset
    455				     ;	     cx	= length of string
    456				     ;Exit:
Turbo Assembler	 Version 4.1	    02/26/26 11:37:15	    Page 9
regist~1.asm



    457				     ;Expected:	es contains the	address	of the video memory segment.
    458				     ;Destroyed: cx, bx, di
    459				     ;----------------------------------------------------------------------------------------------
    460
    461
    462	0419			     printfFrameBackground	     proc
    463	0419  50						     push ax
    464	041A  E8 002C						     call getFrameVideoMemoryOffset
    465	041D  58						     pop ax
    466
    467	041E  33 DB						     xor bx, bx
    468	0420  8A DE						     mov bl, dh
    469	0422  80 C3 06						     add bl, 6
    470
    471	0425  33 C9		     printfFrameStr:		     xor cx, cx
    472	0427  8A CA						     mov cl, dl
    473	0429  80 C1 06						     add cl, 6
    474
    475	042C  E8 0044						     call printfFrameBackgroundString
    476
    477	042F  81 C7 00A0					     add di, 160d
    478
    479	0433  50						     push ax
    480	0434  33 C0						     xor ax, ax
    481	0436  8A C2						     mov al, dl
    482	0438  98						     cbw
    483	0439  D1 E0						     shl ax, 1
    484	043B  2B F8						     sub di, ax
    485	043D  83 EF 0C						     sub di, 12
    486	0440  58						     pop ax
    487
    488	0441  FE CB						     dec bl
    489	0443  80 FB 00						     cmp bl, 0
    490	0446  75 DD						     jne printfFrameStr
    491
    492	0448  C3						     ret
    493	0449			     printfFrameBackground	     endp
    494				     ;----------------------------------------------------------------------------------------------
    495				     ;Prints frame centered frame background depending
    496				     ;on the number of lines and their length in the message
    497				     ;Entry: dh	= the number of	lines in the message
    498				     ;	     dl	= max length of	the string in the message
    499				     ;	     al	= frame	color binary code
    500				     ;Exit:
    501				     ;Expected:
    502				     ;Destroyed: bx, di, cl
    503				     ;----------------------------------------------------------------------------------------------
    504
    505
    506	0449			     getFrameVideoMemoryOffset	     proc
    507
    508	0449  BF 0019						     mov di, 25
    509	044C  8A C6						     mov al, dh
    510	044E  98						     cbw
    511	044F  2B F8						     sub di, ax
    512	0451  D1 EF						     shr di, 1
    513	0453  83 EF 03						     sub di, 3d
Turbo Assembler	 Version 4.1	    02/26/26 11:37:15	    Page 10
regist~1.asm



    514	0456  B8 00A0						     mov ax, 160
    515	0459  52						     push dx
    516	045A  F7 E7						     mul di
    517	045C  5A						     pop dx
    518	045D  8B F8						     mov di, ax
    519
    520	045F  33 C0						     xor ax, ax
    521	0461  8A C2						     mov al, dl
    522	0463  98						     cbw
    523
    524	0464  BB 0050						     mov bx, 80
    525	0467  2B D8						     sub bx, ax
    526	0469  83 EB 06						     sub bx, 6d
    527	046C  D1 EB						     shr bx, 1
    528	046E  D1 E3						     shl bx, 1
    529	0470  03 FB						     add di, bx
    530
    531	0472  C3						     ret
    532	0473			     getFrameVideoMemoryOffset	     endp
    533				     ;----------------------------------------------------------------------------------------------
    534				     ;Gets a video memory offset for frame background depending
    535				     ;on the number of lines and their length in the message
    536				     ;Entry: dh	= the number of	lines in the message
    537				     ;	     dl	= max length of	the string in the message
    538				     ;Exit:  di	= video	memory offset for frame	background
    539				     ;Expected:
    540				     ;Destroyed: ax, bx, di
    541				     ;----------------------------------------------------------------------------------------------
    542
    543
    544	0473			     printfFrameBackgroundString	 proc
    545
    546	0473  26: 88 45	01	     @@printfByte:			 mov byte ptr es:[di+1], al
    547	0477  83 C7 02							 add di, 2
    548	047A  E2 F7							 loop @@printfByte
    549
    550	047C  C3							 ret
    551	047D			     printfFrameBackgroundString	 endp
    552				     ;----------------------------------------------------------------------------------------------
    553				     ;Prints frameBackground string a certain of color
    554				     ;Entry: di	= starting address of the string
    555				     ;	     al	= frame	color binary code
    556				     ;	     cl	= length of the	string
    557				     ;Exit:
    558				     ;Expected:	es contains the	address	of the video memory segment.
    559				     ;Destroyed: di, cl
    560				     ;----------------------------------------------------------------------------------------------
    561
    562	047D			     printfFrameForeground	     proc
    563
    564	047D  81 EF 0140					     sub di, 160*2
    565	0481  83 C7 02						     add di, 2
    566
    567	0484  B0 C8						     mov al, 0C8h
    568	0486  26: 88 05						     mov byte ptr es:[di], al
    569
    570	0489  83 C7 02						     add di, 2
Turbo Assembler	 Version 4.1	    02/26/26 11:37:15	    Page 11
regist~1.asm



    571
    572	048C  33 C9						     xor cx, cx
    573	048E  8A CA						     mov cl, dl
    574	0490  80 C1 02						     add cl, 2
    575
    576	0493  B0 CD						     mov al, 0CDh
    577	0495  50						     push ax
    578	0496  B4 00						     mov ah, 0
    579	0498  E8 007C						     call printHorizontalString
    580	049B  58						     pop ax
    581
    582	049C  B0 BC						     mov al, 0BCh
    583	049E  26: 88 05						     mov byte ptr es:[di], al
    584
    585	04A1  8A C6						     mov al, dh
    586	04A3  04 03						     add al, 3
    587	04A5  50						     push ax
    588	04A6  98						     cbw
    589	04A7  BB 00A0						     mov bx, 160d
    590	04AA  52						     push dx
    591	04AB  F7 E3						     mul bx
    592	04AD  5A						     pop dx
    593	04AE  2B F8						     sub di, ax
    594	04B0  58						     pop ax
    595
    596	04B1  B0 BB						     mov al, 0BBh
    597	04B3  26: 88 05						     mov byte ptr es:[di], al
    598
    599	04B6  83 EF 02						     sub di, 2
    600
    601	04B9  33 C9						     xor cx, cx
    602	04BB  8A CA						     mov cl, dl
    603	04BD  80 C1 02						     add cl, 2
    604	04C0  B0 CD						     mov al, 0CDh
    605	04C2  50						     push ax
    606	04C3  B4 01						     mov ah, 1
    607	04C5  E8 004F						     call printHorizontalString
    608	04C8  58						     pop ax
    609
    610	04C9  B0 C9						     mov al, 0C9h
    611	04CB  26: 88 05						     mov byte ptr es:[di], al
    612	04CE  81 C7 00A0					     add di, 80d*2
    613
    614	04D2  8A CE						     mov cl, dh
    615	04D4  80 C1 02						     add cl, 2
    616	04D7  B0 BA						     mov al, 0BAh
    617	04D9  50						     push ax
    618	04DA  B4 00						     mov ah, 0
    619	04DC  E8 FF28						     call printfVerticalString
    620	04DF  58						     pop ax
    621
    622	04E0  81 EF 00A0					     sub di, 80d*2
    623
    624	04E4  50						     push ax
    625	04E5  8A C2						     mov al, dl
    626	04E7  04 03						     add al, 3
    627	04E9  98						     cbw
Turbo Assembler	 Version 4.1	    02/26/26 11:37:15	    Page 12
regist~1.asm



    628	04EA  D1 E0						     shl ax, 1
    629	04EC  03 F8						     add di, ax
    630	04EE  58						     pop ax
    631
    632	04EF  8A CE						     mov cl, dh
    633	04F1  80 C1 02						     add cl, 2
    634	04F4  B0 BA						     mov al, 0BAh
    635	04F6  50						     push ax
    636	04F7  B4 01						     mov ah, 1
    637	04F9  E8 FF0B						     call printfVerticalString
    638	04FC  58						     pop ax
    639
    640	04FD  81 C7 00A0					     add di, 2*80d
    641	0501  B0 00						     mov al, 0h
    642	0503  E8 0023						     call printfInternalFrame
    643
    644	0506  80 C6 04						     add dh, 4h
    645	0509  80 C2 04						     add dl, 4h
    646	050C  81 EF 00A0					     sub di, (80d*2)
    647	0510  83 C7 06						     add di, 6h
    648	0513  E8 0013						     call printfInternalFrame
    649
    650	0516  C3						     ret
    651	0517			     printfFrameForeground	     endp
    652				     ;----------------------------------------------------------------------------------------------
    653				     ;Prints centered frame foreground depending
    654				     ;on the number of lines and their length in the message
    655				     ;Entry: dh	= the number of	lines in the message
    656				     ;	     dl	= max length of	the string in the message
    657				     ;	     di	= video	memory offset of the lower right corner	of the frame
    658				     ;Exit:
    659				     ;Expected:	es contains the	address	of the video memory segment.
    660				     ;Destroyed: ax, bx, cx, si, di
    661				     ;----------------------------------------------------------------------------------------------
    662
    663
    664	0517			     printHorizontalString   proc
    665	0517  BB 0002					     mov bx, 2
    666	051A  80 FC 00					     cmp ah, 0
    667	051D  74 02					     je	@@nextElem
    668	051F  F7 DB					     neg bx
    669
    670	0521  26: 88 05		     @@nextElem:	     mov byte ptr es:[di], al
    671	0524  03 FB					     add di, bx
    672	0526  E2 F9					     loop @@nextElem
    673
    674	0528  C3					     ret
    675
    676	0529			     printHorizontalString   endp
    677				     ;----------------------------------------------------------------------------------------------
    678				     ;Prints horizontal	string
    679				     ;Entry: al	= symbol binary	code
    680				     ;	     ah	= direction flag (a = 0, di += 2; a != 0, di -=	2)
    681				     ;	     di	= video	memory offset
    682				     ;	     cx	= length of string
    683				     ;Exit:
    684				     ;Expected:	es contains the	address	of the video memory segment.
Turbo Assembler	 Version 4.1	    02/26/26 11:37:15	    Page 13
regist~1.asm



    685				     ;Destroyed: cx, bx
    686				     ;----------------------------------------------------------------------------------------------
    687
    688	0529			     printfInternalFrame	     proc
    689
    690	0529  83 EF 02						     sub di, 2
    691	052C  8A CA						     mov cl, dl
    692	052E  80 C1 02						     add cl, 2
    693	0531  B4 01						     mov ah, 1
    694	0533  E8 FFE1						     call printHorizontalString
    695
    696	0536  83 C7 02						     add di, 2
    697	0539  8A CE						     mov cl, dh
    698	053B  80 C1 02						     add cl, 2
    699	053E  B4 00						     mov ah, 0
    700	0540  E8 FEC4						     call printfVerticalString
    701
    702	0543  81 EF 00A0					     sub di, 2*80d
    703	0547  8A CA						     mov cl, dl
    704	0549  80 C1 02						     add cl, 2
    705	054C  B4 00						     mov ah, 0
    706	054E  E8 FFC6						     call printHorizontalString
    707
    708	0551  83 EF 02						     sub di, 2
    709	0554  8A CE						     mov cl, dh
    710	0556  80 C1 02						     add cl, 2
    711	0559  B4 01						     mov ah, 1
    712	055B  E8 FEA9						     call printfVerticalString
    713
    714	055E  C3						     ret
    715	055F			     printfInternalFrame	     endp
    716				     ;----------------------------------------------------------------------------------------------
    717				     ;Prints centered internal frame foreground	depending
    718				     ;on the number of lines and their length in the message
    719				     ;Entry: al	= internal frame symbol	ascii-code
    720				     ;	     dh	= the number of	lines in the message
    721				     ;	     dl	= max length of	the string in the message
    722				     ;	     di	= video	memory offset of the upper right corner	of the frame
    723				     ;Exit:
    724				     ;Expected:	es contains the	address	of the video memory segment.
    725				     ;Destroyed: ax, cx, si, di
    726				     ;----------------------------------------------------------------------------------------------
    727
    728	055F			     printfRegistersFrame    proc
    729
    730	055F  E8 FEB7					     call printfFrameBackground
    731
    732	0562  E8 FF18					     call printfFrameForeground
    733
    734	0565  BF 02D4					     mov di, (80d*4+42d)*2
    735	0568  26: C6 05	CB				     mov byte ptr es:[di], 0CBh
    736	056C  81 C7 00A0				     add di, 80d*2
    737	0570  B0 BA					     mov al, 0BAh
    738	0572  32 E4					     xor ah, ah
    739	0574  B9 000F					     mov cx, 15d
    740	0577  E8 FE8D					     call printfVerticalString
    741	057A  26: C6 05	CA				     mov byte ptr es:[di], 0CAh
Turbo Assembler	 Version 4.1	    02/26/26 11:37:15	    Page 14
regist~1.asm



    742
    743	057E  81 EF 00A2				     sub di, 162d
    744	0582  32 C0					     xor al, al
    745	0584  B4 01					     mov ah, 1
    746	0586  B9 000F					     mov cx, 15d
    747	0589  E8 FE7B					     call printfVerticalString
    748
    749	058C  81 C7 00A4				     add di, 164d
    750	0590  32 E4					     xor ah, ah
    751	0592  B9 000F					     mov cx, 15d
    752	0595  E8 FE6F					     call printfVerticalString
    753
    754	0598  BF 0370					     mov di, (80d*5+40d)*2
    755	059B  B9 000F					     mov cx, 15d
    756	059E  E8 FE66					     call printfVerticalString
    757
    758	05A1  BF 0366					     mov di, (80d*5+35d)*2
    759	05A4  B9 000F					     mov cx, 15d
    760	05A7  E8 FE5D					     call printfVerticalString
    761
    762	05AA  C3					     ret
    763	05AB			     printfRegistersFrame    endp
    764
    765	05AB  00		     printfRegsFlag	     db	 0
    766
    767	05AC			     endOfProgram:
    768				     end		     Start
Turbo Assembler	 Version 4.1	    02/26/26 11:37:15	    Page 15
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "02/26/26"
??FILENAME			  Text	 "regist~1"
??TIME				  Text	 "11:37:15"
??VERSION			  Number 040A
@32BIT				  Text	 0
@@CONTINUE			  Near	 DGROUP:0191
@@END				  Near	 DGROUP:02BA
@@NEXTELEM			  Near	 DGROUP:0411
@@NEXTELEM			  Near	 DGROUP:0521
@@NORMALMODE			  Near	 DGROUP:012A
@@NOTLETTER1			  Near	 DGROUP:02D1
@@NOTLETTER2			  Near	 DGROUP:02E5
@@NOTLETTER3			  Near	 DGROUP:02F9
@@NOTLETTER4			  Near	 DGROUP:030D
@@PRINTFBYTE			  Near	 DGROUP:0473
@@ZEROAF			  Near	 DGROUP:037E
@@ZEROCF			  Near	 DGROUP:032C
@@ZERODF			  Near	 DGROUP:03A0
@@ZEROIF			  Near	 DGROUP:038F
@@ZEROOF			  Near	 DGROUP:035E
@@ZEROPF			  Near	 DGROUP:036E
@@ZEROSF			  Near	 DGROUP:034D
@@ZEROZF			  Near	 DGROUP:033C
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0707H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 REGIST~1
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
ENDOFPROGRAM			  Near	 DGROUP:05AC
ENDRESIDENTPROGRAM		  Near	 DGROUP:010E
GETFRAMEVIDEOMEMORYOFFSET	  Near	 DGROUP:0449
OLD08OFS			  Word	 DGROUP:02BB
OLD08SEG			  Word	 DGROUP:02BD
OLD09OFS			  Word	 DGROUP:013C
OLD09SEG			  Word	 DGROUP:013E
PRINTFFLAGS			  Near	 DGROUP:0312
PRINTFFLAGSCOLUMN		  Near	 DGROUP:03A1
PRINTFFRAMEBACKGROUND		  Near	 DGROUP:0419
PRINTFFRAMEBACKGROUNDSTRING	  Near	 DGROUP:0473
PRINTFFRAMEFOREGROUND		  Near	 DGROUP:047D
PRINTFFRAMESTR			  Near	 DGROUP:0425
PRINTFHEXREGVALUE		  Near	 DGROUP:02BF
PRINTFINTERNALFRAME		  Near	 DGROUP:0529
PRINTFREGISTERSFRAME		  Near	 DGROUP:055F
PRINTFREGS08INT			  Near	 DGROUP:0186
PRINTFREGSFLAG			  Byte	 DGROUP:05AB
PRINTFVERTICALSTRING		  Near	 DGROUP:0407
PRINTHORIZONTALSTRING		  Near	 DGROUP:0517
Turbo Assembler	 Version 4.1	    02/26/26 11:37:15	    Page 16
Symbol Table



REGISTERSDEBUGGER09INT		  Near	 DGROUP:011A
REPLACE08INT			  Near	 DGROUP:0163
REPLACE09INT			  Near	 DGROUP:0140
START				  Near	 DGROUP:0100

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0000 Word	  Public  DATA
  _TEXT				  16  05AC Word	  Public  CODE
